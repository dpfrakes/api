Application program interfaces (APIs) are protocols and specifications for how a particular software service works. When you search for your local weather forecast, for example, whatever site you use will send weather data for your location using the same query parameters, response format, and subroutines as it would for any other valid location. This blog illustrates how to search for and exploit this functionality on websites to retrieve these API data and integrate them into third-party sites, apps, or feeds.

If you want to have up-to-date weather, live stock prices, or other time- and/or location-dependent data on your website, you'll need access to an API. Many providers will offer a free API authentication token for limited usage, like <a href="https://darksky.net/dev/">Dark Sky</a> that offers 1,000 weather data requests per day for free. You can find lots of free APIs just by searching the web, but you can see a popular list of <a href="https://github.com/toddmotto/public-apis">free APIs here</a>. For paid and "freemium" API providers, the higher the volume and frequency of requests, the more expensive it becomes.

Since going to the websites that advertise these services is free, though, I wondered how easy it would be to "hack" a website that used its own API.

In preparation for a <a href="https://www.spartan.com/">Spartan Sprint</a> in 2016, I subscribed to their "Workout of the Day." I wanted to pull it up on my phone without having to go to their website or search through my inbox, so I took a closer look at the website and found an API link I might be able to use.

Check out the Spartan Race website and find the <a href="https://www.spartan.com/en/training/wods/spartan-wod">Workout of the Day</a> page.

Open up the Developer Tools in your browser and look at the Network tab. Generally, you can filter by XHR (XMLHttpRequest) to find API calls. In this case, just search for "route" and you should find the request that looks like this:

<div class="codeblock">https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&secondary=spartan-wod&primary=1</div>

The URL's <a href="https://en.wikipedia.org/wiki/Subdomain#Overview">subdomain</a> "api" is a pretty good indicator this is what we're looking for.

If you click on this request and view the HTTP response body, you'll see JSON that conveniently contains properly-formatted HTML for each daily workout for the current week, ready to be written straight to a webpage.

Copy that whole link and add it to your webpage's JS file as an AJAX request (sample code assumes you have <a href="https://api.jquery.com">jQuery</a> enabled on your page):

<div class="codeblock">$.get('https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&secondary=spartan-wod&primary=1', function(data) {
  console.log('Retrieved this data from API:');
  console.log(data);
});</div>

After successfully retrieving this data, I needed to whittle down the results to find just the workout for a particular day:

<div class="codeblock">$.get('https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&secondary=spartan-wod&primary=1', function(data) {
  var workoutHtml = data.wods[0].post_content;
  document.write(workoutHtml);
});</div>

This should replace whatever is currently on your webpage with the Workout of the Day for Sunday ("Day 0") of this week.

After modifying the callback function to find the workout for the current day of the week, I was pretty satisfied just loading this every day for a while, but realized I could easily optimize it a bit. The first things to go were the unnecessary images.

To conserve screen real estate, and more importantly, decrease data usage, I sabotaged the image requests by changing their filenames before the browser could load them:

<div class="codeblock">$.get('https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&secondary=spartan-wod&primary=1', function(data) {
  var workoutHtml = data.wods[0].post_content;
  workoutHtml = workoutHtml.split('jpg').join('x');
  workoutHtml = workoutHtml.split('png').join('x');
  document.write(workoutHtml);
});</div>

If you run the above script in a fresh browser page, you'll see the failed HTTP requests (403 Forbidden) for each image, as the browser tried to get "image.x" instead of "image.jpg". Additionally, you'll notice a significant decrease in data transferred, as the images are several KB each, whereas 403 responses cost just a few bytes.

The last step to get a basic prototype working is to hide the resulting broken images on the page. A simple CSS adjustment fixes this:

<div class="codeblock">$.get('https://api.spartan.com/v6/api/get_page/?route=spartan.training.wod&secondary=spartan-wod&primary=1', function(data) {
  var workoutHtml = data.wods[0].post_content;
  workoutHtml = workoutHtml.split('jpg').join('x');
  workoutHtml = workoutHtml.split('png').join('x');
  document.write(workoutHtml);
  $('img').hide();
});</div>

And that's it. Add it to a webpage or mobile app and you've got free, performance-optimized API content.
